<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/media/logo.png">
  <title>Order Confirmation - myMart</title>
  <style>
    /* ===== General Styles ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    /* ===== Navbar ===== */
    nav {
      background: #91ADC8;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .logo img {
      height: 50px;
    }

    .nav-links {
      display: flex;
      gap: 20px;
      list-style: none;
    }

    .nav-links a {
      text-decoration: none;
      color: #fff;
      font-size: 16px;
      transition: color 0.3s;
      font-weight: 500;
    }

    .nav-links a:hover {
      color: #ffcc00;
    }

    .nav-links a.active {
      color: #ffcc00;
      font-weight: 600;
    }

    .actions {
      display: flex;
      gap: 15px;
    }

    .actions a {
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      background: #ff7a18;
      padding: 8px 16px;
      border-radius: 6px;
      transition: background 0.3s;
      font-weight: 500;
    }

    .actions a:hover {
      background: #e26500;
    }

    .cart-count {
      background: #ff3333;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
      position: absolute;
      top: -5px;
      right: -5px;
    }

    .cart-link {
      position: relative;
    }

    /* ===== Confirmation Container ===== */
    .confirmation-container {
      max-width: 1200px;
      margin: 100px auto 50px;
      padding: 0 20px;
    }

    /* ===== Success Header ===== */
    .success-header {
      text-align: center;
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      animation: slideUp 0.6s ease-out;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: #2ecc71;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: bounce 1s ease-in-out;
    }

    .success-icon::before {
      content: "‚úì";
      color: white;
      font-size: 40px;
      font-weight: bold;
    }

    .success-header h1 {
      font-size: 36px;
      color: #2e7d32;
      margin-bottom: 10px;
    }

    .success-header p {
      font-size: 18px;
      color: #666;
      margin-bottom: 20px;
    }

    .order-number {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 16px;
      display: inline-block;
    }

    /* ===== Order Details ===== */
    .order-details {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .order-summary {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .order-summary h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .order-items {
      margin-bottom: 25px;
    }

    .order-item {
      display: flex;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .order-item img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
      margin-right: 20px;
    }

    .item-details {
      flex: 1;
    }

    .item-details h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 5px;
    }

    .item-details p {
      color: #666;
      font-size: 14px;
    }

    .item-price {
      font-weight: 600;
      color: #333;
      font-size: 16px;
      text-align: right;
    }

    .item-quantity {
      color: #666;
      font-size: 14px;
      margin-top: 5px;
    }

    .order-totals {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .total-row:last-child {
      margin-bottom: 0;
      font-weight: 600;
      font-size: 18px;
      color: #ff7a18;
      border-top: 1px solid #e0e0e0;
      padding-top: 10px;
    }

    /* ===== Order Info Sidebar ===== */
    .order-info {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      height: fit-content;
    }

    .info-section {
      margin-bottom: 25px;
    }

    .info-section:last-child {
      margin-bottom: 0;
    }

    .info-section h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }

    .info-section h3::before {
      content: "‚Ä¢";
      color: #ff7a18;
      margin-right: 8px;
      font-size: 24px;
    }

    .info-content p {
      color: #666;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .info-content strong {
      color: #333;
    }

    /* ===== Tracking Section ===== */
    .tracking-section {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .tracking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .tracking-header h2 {
      font-size: 24px;
      color: #333;
    }

    .tracking-status {
      background: #e3f2fd;
      color: #1976d2;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
    }

    .tracking-timeline {
      position: relative;
      padding: 20px 0;
    }

    .timeline-progress {
      position: absolute;
      top: 40px;
      left: 20px;
      width: 4px;
      height: calc(100% - 80px);
      background: #e0e0e0;
    }

    .timeline-progress-fill {
      position: absolute;
      top: 40px;
      left: 20px;
      width: 4px;
      height: 60%;
      background: #ff7a18;
      transition: height 0.5s ease;
    }

    .timeline-steps {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .timeline-step {
      display: flex;
      align-items: flex-start;
      gap: 20px;
    }

    .step-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      flex-shrink: 0;
    }

    .step-icon.active {
      background: #ff7a18;
      color: white;
    }

    .step-icon.completed {
      background: #2ecc71;
      color: white;
    }

    .step-content {
      flex: 1;
    }

    .step-content h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 5px;
    }

    .step-content p {
      color: #666;
      font-size: 14px;
    }

    .step-content .step-time {
      color: #999;
      font-size: 12px;
      margin-top: 5px;
    }

    /* ===== Next Steps ===== */
    .next-steps {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .next-steps h2 {
      font-size: 24px;
      color: #333;
      margin-bottom: 25px;
    }

    .steps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .step-card {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .step-card:hover {
      transform: translateY(-5px);
    }

    .step-icon-large {
      font-size: 40px;
      margin-bottom: 15px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .step-card h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }

    .step-card p {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
    }

    /* ===== Action Buttons ===== */
    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-align: center;
    }

    .btn-primary {
      background: #ff7a18;
      color: white;
    }

    .btn-primary:hover {
      background: #e26500;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #3498db;
      color: white;
    }

    .btn-secondary:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }

    .btn-outline {
      background: transparent;
      color: #666;
      border: 2px solid #e0e0e0;
    }

    .btn-outline:hover {
      background: #f8f9fa;
      border-color: #ff7a18;
      color: #ff7a18;
    }

    /* ===== Loading State ===== */
    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ff7a18;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    /* ===== Animations ===== */
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-10px);
      }
      60% {
        transform: translateY(-5px);
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ===== Responsive Design ===== */
    @media (max-width: 992px) {
      .order-details {
        grid-template-columns: 1fr;
      }
      
      .order-info {
        order: -1;
      }
    }

    @media (max-width: 768px) {
      .confirmation-container {
        margin-top: 80px;
        padding: 0 15px;
      }

      .success-header {
        padding: 30px 20px;
      }

      .success-header h1 {
        font-size: 28px;
      }

      .order-summary,
      .order-info,
      .tracking-section,
      .next-steps {
        padding: 20px;
      }

      .steps-grid {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .success-header h1 {
        font-size: 24px;
      }

      .order-item {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }

      .order-item img {
        margin-right: 0;
      }

      .timeline-step {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }

      .step-icon {
        align-self: center;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="logo"><img src="/media/logo.png" alt="myMart logo"></div>

    <ul class="nav-links">
      <li><a href="homePage.html">Home</a></li>
      <li><a href="shop.html">Shop</a></li>
      <li><a href="deals.html">Deals</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>

    <div class="actions">
      <a href="profile.html">My Account</a>
      <a href="cart.html" class="cart-link">Cart üõí <span class="cart-count">0</span></a>
    </div>
  </nav>

  <!-- Confirmation Container -->
  <div class="confirmation-container">
    <!-- Loading State -->
    <div class="loading" id="loadingState">
      <div class="loading-spinner"></div>
      <p>Loading your order details...</p>
    </div>

    <!-- Success Header -->
    <div class="success-header" id="successHeader" style="display: none;">
      <div class="success-icon"></div>
      <h1>Order Confirmed!</h1>
      <p>Thank you for your purchase. Your order has been successfully placed.</p>
      <div class="order-number" id="orderNumber">Order #MYMART-12345</div>
    </div>

    <!-- Order Details -->
    <div class="order-details" id="orderDetails" style="display: none;">
      <!-- Order Summary -->
      <div class="order-summary">
        <h2>Order Summary</h2>
        
        <div class="order-items" id="orderItems">
          <!-- Order items will be dynamically populated here -->
        </div>

        <div class="order-totals">
          <div class="total-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="total-row">
            <span>Shipping:</span>
            <span id="shipping">Free</span>
          </div>
          <div class="total-row">
            <span>Tax:</span>
            <span id="tax">$0.00</span>
          </div>
          <div class="total-row">
            <span>Total:</span>
            <span id="total">$0.00</span>
          </div>
        </div>
      </div>

      <!-- Order Information -->
      <div class="order-info">
        <div class="info-section">
          <h3>Shipping Address</h3>
          <div class="info-content" id="shippingAddress">
            <!-- Shipping address will be dynamically populated here -->
          </div>
        </div>

        <div class="info-section">
          <h3>Payment Method</h3>
          <div class="info-content" id="paymentMethod">
            <!-- Payment method will be dynamically populated here -->
          </div>
        </div>

        <div class="info-section">
          <h3>Delivery Method</h3>
          <div class="info-content" id="deliveryMethod">
            <!-- Delivery method will be dynamically populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Tracking Section -->
    <div class="tracking-section" id="trackingSection" style="display: none;">
      <div class="tracking-header">
        <h2>Order Tracking</h2>
        <div class="tracking-status">Processing</div>
      </div>
      
      <div class="tracking-timeline">
        <div class="timeline-progress"></div>
        <div class="timeline-progress-fill"></div>
        
        <div class="timeline-steps">
          <div class="timeline-step">
            <div class="step-icon completed">
              <span>‚úì</span>
            </div>
            <div class="step-content">
              <h4>Order Placed</h4>
              <p>Your order has been successfully placed</p>
              <div class="step-time" id="orderTime">Today, 10:30 AM</div>
            </div>
          </div>
          
          <div class="timeline-step">
            <div class="step-icon active">
              <span>2</span>
            </div>
            <div class="step-content">
              <h4>Processing</h4>
              <p>We're preparing your order for shipment</p>
              <div class="step-time">Estimated: Today, 2:00 PM</div>
            </div>
          </div>
          
          <div class="timeline-step">
            <div class="step-icon">
              <span>3</span>
            </div>
            <div class="step-content">
              <h4>Shipped</h4>
              <p>Your order is on its way</p>
              <div class="step-time">Estimated: Tomorrow</div>
            </div>
          </div>
          
          <div class="timeline-step">
            <div class="step-icon">
              <span>4</span>
            </div>
            <div class="step-content">
              <h4>Delivered</h4>
              <p>Your order has been delivered</p>
              <div class="step-time" id="estimatedDelivery">Estimated: Mar 18, 2025</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Next Steps -->
    <div class="next-steps" id="nextSteps" style="display: none;">
      <h2>What's Next?</h2>
      <div class="steps-grid">
        <div class="step-card">
          <div class="step-icon-large">üìß</div>
          <h3>Order Confirmation</h3>
          <p>We've sent a confirmation email with all order details</p>
        </div>
        
        <div class="step-card">
          <div class="step-icon-large">üì¶</div>
          <h3>Order Processing</h3>
          <p>Your items are being prepared for shipment</p>
        </div>
        
        <div class="step-card">
          <div class="step-icon-large">üöö</div>
          <h3>Shipping Updates</h3>
          <p>You'll receive tracking information once shipped</p>
        </div>
        
        <div class="step-card">
          <div class="step-icon-large">‚≠ê</div>
          <h3>Rate Your Purchase</h3>
          <p>Share your experience after receiving your order</p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" id="actionButtons" style="display: none;">
      <a href="shop.html" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/>
        </svg>
        Continue Shopping
      </a>
      
      <a href="profile.html?tab=orders" class="btn btn-secondary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
          <path d="M7 12h10v2H7zm0-4h10v2H7z"/>
        </svg>
        View Order History
      </a>
      
      <button class="btn btn-outline" onclick="downloadInvoice()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
        Download Invoice
      </button>
      
      <button class="btn btn-outline" onclick="shareOrder()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
        </svg>
        Share Order
      </button>

      <button class="btn btn-outline" onclick="printOrder()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
        </svg>
        Print Confirmation
      </button>
    </div>
  </div>

  <script>
    // Order data structure
    let currentOrder = null;

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadOrderData();
      updateCartCount();
    });

    // Load order data from localStorage or URL parameters
    function loadOrderData() {
      const loadingState = document.getElementById('loadingState');
      const successHeader = document.getElementById('successHeader');
      const orderDetails = document.getElementById('orderDetails');
      const trackingSection = document.getElementById('trackingSection');
      const nextSteps = document.getElementById('nextSteps');
      const actionButtons = document.getElementById('actionButtons');

      // Show loading state
      loadingState.style.display = 'block';

      // Get order data from localStorage (set during checkout)
      setTimeout(() => {
        const orderData = JSON.parse(localStorage.getItem('currentOrder')) || getDefaultOrderData();
        
        if (orderData) {
          currentOrder = orderData;
          displayOrderData(orderData);
          
          // Hide loading, show content
          loadingState.style.display = 'none';
          successHeader.style.display = 'block';
          orderDetails.style.display = 'grid';
          trackingSection.style.display = 'block';
          nextSteps.style.display = 'block';
          actionButtons.style.display = 'flex';
          
          // Clear the cart after successful order
          clearCart();
          
          // Start order tracking animation
          startOrderTracking();
        } else {
          // No order data found, redirect to home
          showToast('No order data found. Redirecting to home...', 'error');
          setTimeout(() => {
            window.location.href = 'homePage.html';
          }, 2000);
        }
      }, 1500);
    }

    // Get default order data (fallback)
    function getDefaultOrderData() {
      // Try to get from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const orderId = urlParams.get('orderId');
      
      if (orderId) {
        // In a real app, you would fetch order data from server using orderId
        return generateOrderFromCart();
      }
      
      // Final fallback - generate from cart
      return generateOrderFromCart();
    }

    // Generate order data from current cart
    function generateOrderFromCart() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const user = JSON.parse(localStorage.getItem('currentUser')) || {};
      
      if (cart.length === 0) {
        return null;
      }
      
      // Calculate totals
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const tax = subtotal * 0.1; // 10% tax
      const total = subtotal + tax;
      
      // Generate order ID
      const orderId = 'MYMART-' + Date.now().toString().slice(-6);
      
      return {
        id: orderId,
        items: cart,
        subtotal: subtotal,
        shipping: 0, // Free shipping
        tax: tax,
        total: total,
        shippingAddress: user.profile ? {
          name: `${user.profile.firstName} ${user.profile.lastName}`,
          street: '123 Main Street',
          city: 'New York',
          state: 'NY',
          zipCode: '10001',
          country: 'United States',
          phone: user.profile.phone || '+1 (555) 123-4567'
        } : {
          name: 'John Smith',
          street: '123 Main Street',
          city: 'New York',
          state: 'NY',
          zipCode: '10001',
          country: 'United States',
          phone: '+1 (555) 123-4567'
        },
        paymentMethod: {
          type: 'Credit Card',
          last4: '4242',
          expiry: '12/2025'
        },
        deliveryMethod: {
          type: 'Express Shipping',
          estimatedDays: '2-3',
          trackingNumber: 'TRK' + Date.now().toString().slice(-9)
        },
        orderDate: new Date().toISOString(),
        estimatedDelivery: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString() // 3 days from now
      };
    }

    // Display order data on the page
    function displayOrderData(orderData) {
      // Update order number
      document.getElementById('orderNumber').textContent = `Order #${orderData.id}`;
      
      // Display order items
      const orderItemsContainer = document.getElementById('orderItems');
      orderItemsContainer.innerHTML = '';
      
      orderData.items.forEach(item => {
        const orderItem = document.createElement('div');
        orderItem.className = 'order-item';
        
        orderItem.innerHTML = `
          <img src="${item.image || '/media/placeholder.jpg'}" alt="${item.name}" onerror="this.src='/media/placeholder.jpg'">
          <div class="item-details">
            <h4>${item.name}</h4>
            <p>${item.description || 'No description available'}</p>
            ${item.quantity > 1 ? `<div class="item-quantity">Quantity: ${item.quantity}</div>` : ''}
          </div>
          <div class="item-price">$${(item.price * item.quantity).toLocaleString()}</div>
        `;
        
        orderItemsContainer.appendChild(orderItem);
      });
      
      // Update totals
      document.getElementById('subtotal').textContent = `$${orderData.subtotal.toLocaleString()}`;
      document.getElementById('tax').textContent = `$${orderData.tax.toLocaleString()}`;
      document.getElementById('total').textContent = `$${orderData.total.toLocaleString()}`;
      
      // Update shipping address
      const shippingAddress = document.getElementById('shippingAddress');
      shippingAddress.innerHTML = `
        <p><strong>${orderData.shippingAddress.name}</strong></p>
        <p>${orderData.shippingAddress.street}</p>
        <p>${orderData.shippingAddress.city}, ${orderData.shippingAddress.state} ${orderData.shippingAddress.zipCode}</p>
        <p>${orderData.shippingAddress.country}</p>
        <p>Phone: ${orderData.shippingAddress.phone}</p>
      `;
      
      // Update payment method
      const paymentMethod = document.getElementById('paymentMethod');
      paymentMethod.innerHTML = `
        <p><strong>${orderData.paymentMethod.type}</strong></p>
        <p>Ending in ${orderData.paymentMethod.last4}</p>
        <p>Expires ${orderData.paymentMethod.expiry}</p>
      `;
      
      // Update delivery method
      const deliveryMethod = document.getElementById('deliveryMethod');
      deliveryMethod.innerHTML = `
        <p><strong>${orderData.deliveryMethod.type}</strong></p>
        <p>Estimated delivery: ${orderData.deliveryMethod.estimatedDays} business days</p>
        <p>Tracking number: ${orderData.deliveryMethod.trackingNumber}</p>
      `;
      
      // Update order time
      const orderTime = new Date(orderData.orderDate);
      document.getElementById('orderTime').textContent = `Today, ${orderTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
      
      // Update estimated delivery
      const deliveryDate = new Date(orderData.estimatedDelivery);
      document.getElementById('estimatedDelivery').textContent = `Estimated: ${deliveryDate.toLocaleDateString()}`;
    }

    // Clear cart after successful order
    function clearCart() {
      localStorage.removeItem('cart');
      updateCartCount();
    }

    // Update cart count
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
      document.querySelector('.cart-count').textContent = totalItems;
    }

    // Simulate order tracking updates
    function startOrderTracking() {
      let progress = 0;
      const progressFill = document.querySelector('.timeline-progress-fill');
      const timelineSteps = document.querySelectorAll('.timeline-step');
      
      // Animate progress bar
      const progressInterval = setInterval(() => {
        progress += 0.5;
        if (progress <= 60) {
          progressFill.style.height = `${progress}%`;
        } else {
          clearInterval(progressInterval);
        }
      }, 50);

      // Simulate step completion
      setTimeout(() => {
        timelineSteps[1].querySelector('.step-icon').classList.add('completed');
        timelineSteps[1].querySelector('.step-icon').innerHTML = '‚úì';
        document.querySelector('.tracking-status').textContent = 'Shipped';
        document.querySelector('.tracking-status').style.background = '#e3f2fd';
        document.querySelector('.tracking-status').style.color = '#1976d2';
      }, 3000);

      setTimeout(() => {
        timelineSteps[2].querySelector('.step-icon').classList.add('active');
      }, 5000);
    }

    // Download invoice
    function downloadInvoice() {
      if (!currentOrder) {
        showToast('No order data available', 'error');
        return;
      }
      
      showToast('Preparing your invoice for download...');
      
      setTimeout(() => {
        showToast('Invoice downloaded successfully!', 'success');
        
        const invoiceContent = generateInvoiceContent(currentOrder);
        const blob = new Blob([invoiceContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `myMart-Invoice-${currentOrder.id}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 2000);
    }

    // Generate invoice content
    function generateInvoiceContent(order) {
      let content = `myMart Invoice\n`;
      content += `Order #: ${order.id}\n`;
      content += `Date: ${new Date(order.orderDate).toLocaleDateString()}\n\n`;
      content += `Items:\n`;
      
      order.items.forEach(item => {
        content += `- ${item.name} x${item.quantity}: $${(item.price * item.quantity).toLocaleString()}\n`;
      });
      
      content += `\nSubtotal: $${order.subtotal.toLocaleString()}\n`;
      content += `Shipping: $${order.shipping.toLocaleString()}\n`;
      content += `Tax: $${order.tax.toLocaleString()}\n`;
      content += `Total: $${order.total.toLocaleString()}\n\n`;
      content += `Shipping Address:\n`;
      content += `${order.shippingAddress.name}\n`;
      content += `${order.shippingAddress.street}\n`;
      content += `${order.shippingAddress.city}, ${order.shippingAddress.state} ${order.shippingAddress.zipCode}\n`;
      content += `${order.shippingAddress.country}\n\n`;
      content += `Thank you for shopping with myMart!`;
      
      return content;
    }

    // Share order
    function shareOrder() {
      if (!currentOrder) {
        showToast('No order data available', 'error');
        return;
      }

      if (navigator.share) {
        navigator.share({
          title: `My myMart Order #${currentOrder.id}`,
          text: `I just placed an order on myMart! Total: $${currentOrder.total.toLocaleString()}`,
          url: window.location.href,
        })
        .then(() => showToast('Order shared successfully!', 'success'))
        .catch(() => showToast('Share cancelled', 'error'));
      } else {
        const shareUrl = window.location.href;
        navigator.clipboard.writeText(shareUrl)
          .then(() => showToast('Order link copied to clipboard!', 'success'))
          .catch(() => showToast('Failed to copy link', 'error'));
      }
    }

    // Print order confirmation
    function printOrder() {
      window.print();
    }

    // Toast notification
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: ${type === 'success' ? '#2ecc71' : type === 'error' ? '#e74c3c' : '#3498db'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
      `;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.transform = 'translateY(0)';
        toast.style.opacity = '1';
      }, 100);
      
      setTimeout(() => {
        toast.style.transform = 'translateY(100px)';
        toast.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Save order to order history
    function saveOrderToHistory(order) {
      const orders = JSON.parse(localStorage.getItem('userOrders')) || [];
      orders.unshift(order);
      localStorage.setItem('userOrders', JSON.stringify(orders));
    }
  </script>
</body>
</html>